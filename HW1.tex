\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    
    \usepackage{iftex}
    \ifPDFTeX
    	\usepackage[T1]{fontenc}
    	\usepackage{mathpazo}
    \else
    	\usepackage{fontspec}
    \fi

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}
    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range
    \makeatletter % fix for grffile with XeLaTeX
    \def\Gread@@xetex#1{%
      \IfFileExists{"\Gin@base".bb}%
      {\Gread@eps{\Gin@base.bb}}%
      {\Gread@@xetex@aux#1}%
    }
    \makeatother

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{HW1}
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb. 
    \makeatletter
        \newbox\Wrappedcontinuationbox 
        \newbox\Wrappedvisiblespacebox 
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}} 
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}} 
        \newcommand*\Wrappedcontinuationindent {3ex } 
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox} 
        % Take advantage of the already applied Pygments mark-up to insert 
        % potential linebreaks for TeX processing. 
        %        {, <, #, %, $, ' and ": go to next line. 
        %        _, }, ^, &, >, - and ~: stay at end of broken line. 
        % Use of \textquotesingle for straight quote. 
        \newcommand*\Wrappedbreaksatspecials {% 
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}% 
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}% 
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}% 
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}% 
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}% 
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}% 
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}% 
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}% 
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}% 
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}% 
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}% 
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}% 
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}% 
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}% 
        } 
        % Some characters . , ; ? ! / are not pygmentized. 
        % This macro makes them "active" and they will insert potential linebreaks 
        \newcommand*\Wrappedbreaksatpunct {% 
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}% 
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}% 
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}% 
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}% 
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}% 
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}% 
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}% 
            \catcode`\.\active
            \catcode`\,\active 
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active 
            \lccode`\~`\~ 	
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%
        
        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active 	
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}
    
    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        \ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \hypertarget{hw1}{%
\section{HW1}\label{hw1}}

\hypertarget{overview}{%
\subsection{Overview}\label{overview}}

Preparing the data, computing basic statistics and constructing simple
models are essential steps for data science practice. In this homework,
you will use clinical data as raw input to perform \textbf{Heart Failure
Prediction}. For this homework, \textbf{Python} programming will be
required. See the attached skeleton code as a start-point for the
programming questions.

This homework assumes familiarity with Pandas. If you need a Pandas
crash course, we recommend working through
\href{https://github.com/ajcr/100-pandas-puzzles}{100 Pandas Puzzles},
the solutions are also available at that link.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{k+kn}{import} \PY{n+nn}{sys}

\PY{n}{DATA\PYZus{}PATH} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{../HW1\PYZhy{}lib/data/}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH} \PY{o}{=} \PY{n}{DATA\PYZus{}PATH} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{train/}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{VAL\PYZus{}DATA\PYZus{}PATH} \PY{o}{=} \PY{n}{DATA\PYZus{}PATH} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{val/}\PY{l+s+s2}{\PYZdq{}}
    
\PY{n}{sys}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{../HW1\PYZhy{}lib}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{about-raw-data}{%
\subsection{About Raw Data}\label{about-raw-data}}

For this homework, we will be using a clinical dataset synthesized from
\href{https://www.nature.com/articles/sdata201635}{MIMIC-III}.

Navigate to \texttt{TRAIN\_DATA\_PATH}. There are three CSV files which
will be the input data in this homework.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{!}ls\PY{+w}{ }\PY{n+nv}{\PYZdl{}TRAIN\PYZus{}DATA\PYZus{}PATH}
\end{Verbatim}
\end{tcolorbox}

    \textbf{events.csv}

The data provided in \emph{events.csv} are event sequences. Each line of
this file consists of a tuple with the format \emph{(pid, event\_id,
vid, value)}.

For example,

\begin{verbatim}
33,DIAG_244,0,1
33,DIAG_414,0,1
33,DIAG_427,0,1
33,LAB_50971,0,1
33,LAB_50931,0,1
33,LAB_50812,1,1
33,DIAG_425,1,1
33,DIAG_427,1,1
33,DRUG_0,1,1
33,DRUG_3,1,1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \textbf{pid}: De-identified patient identier. For example, the patient
  in the example above has pid 33.
\item
  \textbf{event\_id}: Clinical event identifier. For example, DIAG\_244
  means the patient was diagnosed of disease with ICD9 code
  \href{http://www.icd9data.com/2013/Volume1/240-279/240-246/244/244.htm}{244};
  LAB\_50971 means that the laboratory test with code 50971 was
  conducted on the patient; and DRUG\_0 means that a drug with code 0
  was prescribed to the patient. Corresponding lab (drug) names can be
  found in \texttt{\{DATA\_PATH\}/lab\_list.txt}
  (\texttt{\{DATA\_PATH\}/drug\_list.txt}).
\item
  \textbf{vid}: Visit identifier. For example, the patient has two
  visits in total. Note that vid is ordinal. That is, visits with bigger
  vid occour after that with smaller vid.
\item
  \textbf{value}: Contains the value associated to an event (always 1 in
  the synthesized dataset).
\end{itemize}

    \textbf{hf\_events.csv}

The data provided in \emph{hf\_events.csv} contains pid of patients who
have been diagnosed with heart failure (i.e., DIAG\_398, DIAG\_402,
DIAG\_404, DIAG\_428) in at least one visit. They are in the form of a
tuple with the format \emph{(pid, vid, label)}. For example,

\begin{verbatim}
156,0,1
181,1,1
\end{verbatim}

The vid indicates the index of the first visit with heart failure of
that patient and a label of 1 indicates the presence of heart failure.
\textbf{Note that only patients with heart failure are included in this
file. Patients who are not mentioned in this file have never been
diagnosed with heart failure.}

    \textbf{event\_feature\_map.csv}

The \emph{event\_feature\_map.csv} is a map from an event\_id to an
integer index. This file contains \emph{(idx, event\_id)} pairs for all
event ids.

    \hypertarget{descriptive-statistics-20-points}{%
\subsection{1 Descriptive Statistics {[}20
points{]}}\label{descriptive-statistics-20-points}}

Before starting analytic modeling, it is a good practice to get
descriptive statistics of the input raw data. In this question, you need
to write code that computes various metrics on the data described
previously. A skeleton code is provided to you as a starting point.

The definition of terms used in the result table are described below:

\begin{itemize}
\tightlist
\item
  \textbf{Event count}: Number of events recorded for a given patient.
\item
  \textbf{Encounter count}: Number of visits recorded for a given
  patient.
\end{itemize}

Note that every line in the input file is an event, while each visit
consists of multiple events.

    \textbf{Complete the following code cell to implement the required
statistics.}

Please be aware that \textbf{you are NOT allowed to change the filename
and any existing function declarations.} Only \texttt{numpy},
\texttt{scipy}, \texttt{scikit-learn}, \texttt{pandas} and other
built-in modules of python will be available for you to use. The use of
\texttt{pandas} library is suggested.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{time}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{datetime}

\PY{k}{def} \PY{n+nf}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}\PY{p}{:}
    
    \PY{n}{events} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{events.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{hf} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{hf\PYZus{}events.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{k}{return} \PY{n}{events}\PY{p}{,} \PY{n}{hf}

\PY{k}{def} \PY{n+nf}{event\PYZus{}count\PYZus{}metrics}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}\PY{p}{:}
    
    \PY{c+c1}{\PYZsh{} Get all the unique patient ID with Heart failure}
    \PY{n}{hf\PYZus{}patient\PYZus{}id} \PY{o}{=} \PY{n}{hf}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Count total events per patient in events (all patients)}
    \PY{n}{event\PYZus{}counts} \PY{o}{=} \PY{n}{events}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Spereate Heart Failure patients from normal patients}
    \PY{n}{hf\PYZus{}events\PYZus{}counts} \PY{o}{=} \PY{n}{event\PYZus{}counts}\PY{p}{[}\PY{n}{event\PYZus{}counts}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{hf\PYZus{}patient\PYZus{}id}\PY{p}{)}\PY{p}{]}
    \PY{n}{norm\PYZus{}event\PYZus{}counts} \PY{o}{=} \PY{n}{event\PYZus{}counts}\PY{p}{[}\PY{o}{\PYZti{}}\PY{n}{event\PYZus{}counts}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{hf\PYZus{}patient\PYZus{}id}\PY{p}{)}\PY{p}{]}
    
    \PY{c+c1}{\PYZsh{} Calculate Heart Failure metrics}
    \PY{n}{avg\PYZus{}hf\PYZus{}event\PYZus{}count} \PY{o}{=} \PY{n}{hf\PYZus{}events\PYZus{}counts}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{max\PYZus{}hf\PYZus{}event\PYZus{}count} \PY{o}{=} \PY{n}{hf\PYZus{}events\PYZus{}counts}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}hf\PYZus{}event\PYZus{}count} \PY{o}{=} \PY{n}{hf\PYZus{}events\PYZus{}counts}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Calculate Normal patient metrics}
    \PY{n}{avg\PYZus{}norm\PYZus{}event\PYZus{}count} \PY{o}{=} \PY{n}{norm\PYZus{}event\PYZus{}counts}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{max\PYZus{}norm\PYZus{}event\PYZus{}count} \PY{o}{=} \PY{n}{norm\PYZus{}event\PYZus{}counts}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}norm\PYZus{}event\PYZus{}count} \PY{o}{=} \PY{n}{norm\PYZus{}event\PYZus{}counts}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}
    

    \PY{k}{return} \PY{n}{avg\PYZus{}hf\PYZus{}event\PYZus{}count}\PY{p}{,} \PY{n}{max\PYZus{}hf\PYZus{}event\PYZus{}count}\PY{p}{,} \PY{n}{min\PYZus{}hf\PYZus{}event\PYZus{}count}\PY{p}{,} \PYZbs{}
           \PY{n}{avg\PYZus{}norm\PYZus{}event\PYZus{}count}\PY{p}{,} \PY{n}{max\PYZus{}norm\PYZus{}event\PYZus{}count}\PY{p}{,} \PY{n}{min\PYZus{}norm\PYZus{}event\PYZus{}count}

\PY{k}{def} \PY{n+nf}{encounter\PYZus{}count\PYZus{}metrics}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}\PY{p}{:}

    \PY{c+c1}{\PYZsh{} Get unique patient ID from hf\PYZus{}events}
    \PY{n}{hf\PYZus{}patient\PYZus{}id} \PY{o}{=} \PY{n}{hf}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
    
    \PY{n}{patient\PYZus{}visits} \PY{o}{=} \PY{n}{events}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{nunique}\PY{p}{(}\PY{p}{)}
    
    \PY{n}{hf\PYZus{}encounter\PYZus{}counts} \PY{o}{=} \PY{n}{patient\PYZus{}visits}\PY{p}{[}\PY{n}{patient\PYZus{}visits}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{hf\PYZus{}patient\PYZus{}id}\PY{p}{)}\PY{p}{]}
    \PY{n}{norm\PYZus{}encounter\PYZus{}counts} \PY{o}{=} \PY{n}{patient\PYZus{}visits}\PY{p}{[}\PY{o}{\PYZti{}}\PY{n}{patient\PYZus{}visits}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{hf\PYZus{}patient\PYZus{}id}\PY{p}{)}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Calculate metrics for heart failure patients}
    \PY{n}{avg\PYZus{}hf\PYZus{}encounter\PYZus{}count} \PY{o}{=} \PY{n}{hf\PYZus{}encounter\PYZus{}counts}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{max\PYZus{}hf\PYZus{}encounter\PYZus{}count} \PY{o}{=} \PY{n}{hf\PYZus{}encounter\PYZus{}counts}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}hf\PYZus{}encounter\PYZus{}count} \PY{o}{=} \PY{n}{hf\PYZus{}encounter\PYZus{}counts}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Calculate metrics for normal patients}
    \PY{n}{avg\PYZus{}norm\PYZus{}encounter\PYZus{}count} \PY{o}{=} \PY{n}{norm\PYZus{}encounter\PYZus{}counts}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{max\PYZus{}norm\PYZus{}encounter\PYZus{}count} \PY{o}{=} \PY{n}{norm\PYZus{}encounter\PYZus{}counts}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}norm\PYZus{}encounter\PYZus{}count} \PY{o}{=} \PY{n}{norm\PYZus{}encounter\PYZus{}counts}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}

    \PY{k}{return} \PY{n}{avg\PYZus{}hf\PYZus{}encounter\PYZus{}count}\PY{p}{,} \PY{n}{max\PYZus{}hf\PYZus{}encounter\PYZus{}count}\PY{p}{,} \PY{n}{min\PYZus{}hf\PYZus{}encounter\PYZus{}count}\PY{p}{,} \PYZbs{}
           \PY{n}{avg\PYZus{}norm\PYZus{}encounter\PYZus{}count}\PY{p}{,} \PY{n}{max\PYZus{}norm\PYZus{}encounter\PYZus{}count}\PY{p}{,} \PY{n}{min\PYZus{}norm\PYZus{}encounter\PYZus{}count}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events}\PY{p}{,} \PY{n}{hf} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}

\PY{c+c1}{\PYZsh{}Compute the event count metrics}
\PY{n}{start\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
\PY{n}{event\PYZus{}count} \PY{o}{=} \PY{n}{event\PYZus{}count\PYZus{}metrics}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{n}{end\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Time to compute event count metrics: }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{end\PYZus{}time} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{s}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{event\PYZus{}count}\PY{p}{)}

\PY{c+c1}{\PYZsh{}Compute the encounter count metrics}
\PY{n}{start\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
\PY{n}{encounter\PYZus{}count} \PY{o}{=} \PY{n}{encounter\PYZus{}count\PYZus{}metrics}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{n}{end\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Time to compute encounter count metrics: }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{end\PYZus{}time} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{s}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{encounter\PYZus{}count}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events}\PY{p}{,} \PY{n}{hf} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{event\PYZus{}count} \PY{o}{=} \PY{n}{event\PYZus{}count\PYZus{}metrics}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{k}{assert} \PY{n}{event\PYZus{}count} \PY{o}{==} \PY{p}{(}\PY{l+m+mf}{188.9375}\PY{p}{,} \PY{l+m+mi}{2046}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mf}{118.64423076923077}\PY{p}{,} \PY{l+m+mi}{1014}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{event\PYZus{}count failed!}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events}\PY{p}{,} \PY{n}{hf} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{encounter\PYZus{}count} \PY{o}{=} \PY{n}{encounter\PYZus{}count\PYZus{}metrics}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{k}{assert} \PY{n}{encounter\PYZus{}count} \PY{o}{==} \PY{p}{(}\PY{l+m+mf}{2.8060810810810812}\PY{p}{,} \PY{l+m+mi}{34}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mf}{2.189423076923077}\PY{p}{,} \PY{l+m+mi}{11}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{encounter\PYZus{}count failed!}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{feature-construction-40-points}{%
\subsection{2 Feature construction {[}40
points{]}}\label{feature-construction-40-points}}

It is a common practice to convert raw data into a standard data format
before running real machine learning models. In this question, you will
implement the necessary python functions in this script. You will work
with \emph{events.csv}, \emph{hf\_events.csv} and
\emph{event\_feature\_map.csv} files provided in
\textbf{TRAIN\_DATA\_PATH} folder. The use of \texttt{pandas} library in
this question is recommended.

Listed below are a few concepts you need to know before beginning
feature construction (for details please refer to lectures).

\begin{itemize}
\tightlist
\item
  \textbf{Index vid}: Index vid is evaluated as follows:

  \begin{itemize}
  \tightlist
  \item
    For heart failure patients: Index vid is the vid of the first visit
    with heart failure for that patient (i.e., vid field in
    \emph{hf\_events.csv}).
  \item
    For normal patients: Index vid is the vid of the last visit for that
    patient (i.e., vid field in \emph{events.csv}).
  \end{itemize}
\item
  \textbf{Observation Window}: The time interval you will use to
  identify relevant events. Only events present in this window should be
  included while constructing feature vectors.
\item
  \textbf{Prediction Window}: A fixed time interval that is to be used
  to make the prediction.
\end{itemize}

In the example above, the index vid is 3. Visits with vid 0, 1, 2 are
within the observation window. The prediction window is between visit 2
and 3.

    \hypertarget{compute-the-index-vid-10-points}{%
\subsubsection{2.1 Compute the index vid {[}10
points{]}}\label{compute-the-index-vid-10-points}}

Use the definition provided above to compute the index vid for all
patients. Complete the method \texttt{read\_csv} and
\texttt{calculate\_index\_vid} provided in the following code cell.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{import} \PY{n+nn}{datetime}


\PY{k}{def} \PY{n+nf}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}\PY{p}{:}

    \PY{n}{events} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{events.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{hf} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{hf\PYZus{}events.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{feature\PYZus{}map} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filepath} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{event\PYZus{}feature\PYZus{}map.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{k}{return} \PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{feature\PYZus{}map}


\PY{k}{def} \PY{n+nf}{calculate\PYZus{}index\PYZus{}vid}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{    Calculate index visit for each patient.}
\PY{l+s+sd}{    For HF patients: first visit with heart failure diagnosis (min visit\PYZus{}id from hf\PYZus{}events)}
\PY{l+s+sd}{    For normal patients: last visit overall (max visit\PYZus{}id from events)}
\PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
    
    \PY{c+c1}{\PYZsh{} Get unique patient IDs from hf\PYZus{}events (heart failure patients)}
    \PY{n}{hf\PYZus{}patient\PYZus{}ids} \PY{o}{=} \PY{n}{hf}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Get all unique patient IDs from events}
    \PY{n}{all\PYZus{}patient\PYZus{}ids} \PY{o}{=} \PY{n}{events}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Create a DataFrame for index visits}
    \PY{n}{indx\PYZus{}vid\PYZus{}data} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    
    \PY{c+c1}{\PYZsh{} For heart failure patients: find the minimum visit\PYZus{}id from hf\PYZus{}events (first HF visit)}
    \PY{k}{for} \PY{n}{patient\PYZus{}id} \PY{o+ow}{in} \PY{n}{hf\PYZus{}patient\PYZus{}ids}\PY{p}{:}
        \PY{n}{patient\PYZus{}hf\PYZus{}visits} \PY{o}{=} \PY{n}{hf}\PY{p}{[}\PY{n}{hf}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{n}{patient\PYZus{}id}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        \PY{n}{index\PYZus{}visit} \PY{o}{=} \PY{n}{patient\PYZus{}hf\PYZus{}visits}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}  \PY{c+c1}{\PYZsh{} First visit with heart failure}
        \PY{n}{indx\PYZus{}vid\PYZus{}data}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{patient\PYZus{}id}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{indx\PYZus{}vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{index\PYZus{}visit}\PY{p}{\PYZcb{}}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} For normal patients: use their LAST visit as index visit}
    \PY{n}{normal\PYZus{}patient\PYZus{}ids} \PY{o}{=} \PY{p}{[}\PY{n}{pid} \PY{k}{for} \PY{n}{pid} \PY{o+ow}{in} \PY{n}{all\PYZus{}patient\PYZus{}ids} \PY{k}{if} \PY{n}{pid} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{hf\PYZus{}patient\PYZus{}ids}\PY{p}{]}
    
    \PY{k}{for} \PY{n}{patient\PYZus{}id} \PY{o+ow}{in} \PY{n}{normal\PYZus{}patient\PYZus{}ids}\PY{p}{:}
        \PY{n}{patient\PYZus{}visits} \PY{o}{=} \PY{n}{events}\PY{p}{[}\PY{n}{events}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{n}{patient\PYZus{}id}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        \PY{n}{index\PYZus{}visit} \PY{o}{=} \PY{n}{patient\PYZus{}visits}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Last visit (changed from min() to max())}
        \PY{n}{indx\PYZus{}vid\PYZus{}data}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{patient\PYZus{}id}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{indx\PYZus{}vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{index\PYZus{}visit}\PY{p}{\PYZcb{}}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} Create the DataFrame}
    \PY{n}{indx\PYZus{}vid} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{indx\PYZus{}vid\PYZus{}data}\PY{p}{,} \PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{indx\PYZus{}vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    
    \PY{k}{return} \PY{n}{indx\PYZus{}vid}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{feature\PYZus{}map} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{indx\PYZus{}vid\PYZus{}df} \PY{o}{=} \PY{n}{calculate\PYZus{}index\PYZus{}vid}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{n}{indx\PYZus{}vid\PYZus{}df}\PY{o}{.}\PY{n}{info}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{indx\PYZus{}vid} \PY{o}{=} \PY{n+nb}{dict}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{indx\PYZus{}vid\PYZus{}df}\PY{o}{.}\PY{n}{pid}\PY{p}{,} \PY{n}{indx\PYZus{}vid\PYZus{}df}\PY{o}{.}\PY{n}{indx\PYZus{}vid}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{indx\PYZus{}vid}\PY{p}{[}\PY{l+m+mi}{78}\PY{p}{]}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{indx\PYZus{}vid}\PY{p}{[}\PY{l+m+mi}{1230}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{feature\PYZus{}map} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{indx\PYZus{}vid\PYZus{}df} \PY{o}{=} \PY{n}{calculate\PYZus{}index\PYZus{}vid}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{k}{assert} \PY{n}{indx\PYZus{}vid\PYZus{}df}\PY{o}{.}\PY{n}{shape} \PY{o}{==} \PY{p}{(}\PY{l+m+mi}{4000}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{calculate\PYZus{}index\PYZus{}vid failed!}\PY{l+s+s2}{\PYZdq{}}

\PY{n}{indx\PYZus{}vid} \PY{o}{=} \PY{n+nb}{dict}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{indx\PYZus{}vid\PYZus{}df}\PY{o}{.}\PY{n}{pid}\PY{p}{,} \PY{n}{indx\PYZus{}vid\PYZus{}df}\PY{o}{.}\PY{n}{indx\PYZus{}vid}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{k}{assert} \PY{n}{indx\PYZus{}vid}\PY{p}{[}\PY{l+m+mi}{78}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{calculate\PYZus{}index\PYZus{}vid failed!}\PY{l+s+s2}{\PYZdq{}}
\PY{k}{assert} \PY{n}{indx\PYZus{}vid}\PY{p}{[}\PY{l+m+mi}{1230}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{calculate\PYZus{}index\PYZus{}vid failed!}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{filter-events-10-points}{%
\subsubsection{2.2 Filter events {[}10
points{]}}\label{filter-events-10-points}}

Remove the events that occur outside the observation window. That is,
only keep events in visits before index vid. Complete the method
\emph{filter\_events} provided in the following code cell.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{filter\PYZus{}events}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{indx\PYZus{}vid}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
\PY{l+s+sd}{    Keep only events with vid strictly before the index vid for that patient.}
\PY{l+s+sd}{    Return columns: [\PYZsq{}pid\PYZsq{},\PYZsq{}event\PYZus{}id\PYZsq{},\PYZsq{}value\PYZsq{}]}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{ev} \PY{o}{=} \PY{n}{events}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{indx\PYZus{}vid}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{how}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inner}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ev} \PY{o}{=} \PY{n}{ev}\PY{p}{[}\PY{n}{ev}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{ev}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{indx\PYZus{}vid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
    \PY{n}{filtered\PYZus{}events} \PY{o}{=} \PY{n}{ev}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{event\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
    \PY{k}{return} \PY{n}{filtered\PYZus{}events}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{feature\PYZus{}map} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{indx\PYZus{}vid} \PY{o}{=} \PY{n}{calculate\PYZus{}index\PYZus{}vid}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{n}{filtered\PYZus{}events} \PY{o}{=} \PY{n}{filter\PYZus{}events}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{indx\PYZus{}vid}\PY{p}{)}
\PY{k}{assert} \PY{n}{filtered\PYZus{}events}\PY{p}{[}\PY{n}{filtered\PYZus{}events}\PY{o}{.}\PY{n}{pid} \PY{o}{==} \PY{l+m+mi}{78}\PY{p}{]}\PY{o}{.}\PY{n}{shape} \PY{o}{==} \PY{p}{(}\PY{l+m+mi}{128}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{filter\PYZus{}events failed!}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{aggregate-events-10-points}{%
\subsubsection{2.3 Aggregate events {[}10
points{]}}\label{aggregate-events-10-points}}

To create features suitable for machine learning, we will need to
aggregate the events for each patient as follows:

\begin{itemize}
\tightlist
\item
  \textbf{count} occurences for each event.
\end{itemize}

Each event type will become a feature and we will directly use event\_id
as feature name. For example, given below raw event sequence for a
patient,

\begin{verbatim}
33,DIAG_244,0,1
33,LAB_50971,0,1
33,LAB_50931,0,1
33,LAB_50931,0,1
33,DIAG_244,1,1
33,DIAG_427,1,1
33,DRUG_0,1,1
33,DRUG_3,1,1
33,DRUG_3,1,1
\end{verbatim}

We can get feature value pairs \emph{(event\_id, value)} for this
patient with ID \emph{33} as

\begin{verbatim}
(DIAG_244, 2.0)
(LAB_50971, 1.0)
(LAB_50931, 2.0)
(DIAG_427, 1.0)
(DRUG_0, 1.0)
(DRUG_3, 2.0)
\end{verbatim}

Next, replace each \emph{event\_id} with the \emph{feature\_id} provided
in \emph{event\_feature\_map.csv}.

\begin{verbatim}
(146, 2.0)
(1434, 1.0)
(1429, 2.0)
(304, 1.0)
(898, 1.0)
(1119, 2.0)
\end{verbatim}

Lastly, in machine learning algorithm like logistic regression, it is
important to normalize different features into the same scale. We will
use the
\href{http://stats.stackexchange.com/questions/70801/how-to-normalize-data-to-0-1-range}{min-max
normalization} approach. (Note: we define \(min(x)\) is always 0,
i.e.~the scale equation become \(x\)/\(max(x)\)).

Complete the method \emph{aggregate\_events} provided in the following
code cell.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{aggregate\PYZus{}events}\PY{p}{(}\PY{n}{filtered\PYZus{}events\PYZus{}df}\PY{p}{,} \PY{n}{hf\PYZus{}df}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}df}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
\PY{l+s+sd}{    1) Map event\PYZus{}id \PYZhy{}\PYZgt{} feature\PYZus{}id (idx).}
\PY{l+s+sd}{    2) Aggregate by (pid, feature\PYZus{}id) using count.}
\PY{l+s+sd}{    3) Min\PYZhy{}max normalize per feature: value = count / max\PYZus{}count\PYZus{}for\PYZus{}that\PYZus{}feature.}
\PY{l+s+sd}{    Return columns: [\PYZsq{}pid\PYZsq{},\PYZsq{}feature\PYZus{}id\PYZsq{},\PYZsq{}feature\PYZus{}value\PYZsq{}]}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} 1) map to feature ids}
    \PY{n}{m} \PY{o}{=} \PY{n}{feature\PYZus{}map\PYZus{}df}\PY{o}{.}\PY{n}{rename}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{idx}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{)}
    \PY{n}{fe} \PY{o}{=} \PY{n}{filtered\PYZus{}events\PYZus{}df}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{m}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{event\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{how}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inner}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} 2) aggregate counts}
    \PY{n}{agg} \PY{o}{=} \PY{p}{(}
        \PY{n}{fe}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
          \PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{p}{)}
          \PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{n}{name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{count}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} 3) normalize by feature\PYZhy{}wise max}
    \PY{n}{fmax} \PY{o}{=} \PY{n}{agg}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{count}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{agg}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{agg}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{count}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{/} \PY{n}{fmax}
    \PY{n}{aggregated\PYZus{}events} \PY{o}{=} \PY{n}{agg}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{aggregated\PYZus{}events}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{feature\PYZus{}map} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{index\PYZus{}vid} \PY{o}{=} \PY{n}{calculate\PYZus{}index\PYZus{}vid}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{hf}\PY{p}{)}
\PY{n}{filtered\PYZus{}events} \PY{o}{=} \PY{n}{filter\PYZus{}events}\PY{p}{(}\PY{n}{events}\PY{p}{,} \PY{n}{index\PYZus{}vid}\PY{p}{)}
\PY{n}{aggregated\PYZus{}events} \PY{o}{=} \PY{n}{aggregate\PYZus{}events}\PY{p}{(}\PY{n}{filtered\PYZus{}events}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{feature\PYZus{}map}\PY{p}{)}
\PY{k}{assert} \PY{n}{aggregated\PYZus{}events}\PY{p}{[}\PY{n}{aggregated\PYZus{}events}\PY{o}{.}\PY{n}{pid} \PY{o}{==} \PY{l+m+mi}{88037}\PY{p}{]}\PY{o}{.}\PY{n}{shape} \PY{o}{==} \PY{p}{(}\PY{l+m+mi}{29}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{aggregate\PYZus{}events failed!}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{save-in-svmlight-format-10-points}{%
\subsubsection{2.4 Save in SVMLight format {[}10
points{]}}\label{save-in-svmlight-format-10-points}}

If the dimensionality of a feature vector is large but the feature
vector is sparse (i.e.~it has only a few nonzero elements), sparse
representation should be employed. In this problem you will use the
provided data for each patient to construct a feature vector and
represent the feature vector in SVMLight format.

\begin{verbatim}
<line> .=. <target> <feature>:<value> <feature>:<value>
<target> .=. 1 | 0
<feature> .=. <integer>
<value> .=. <float>
\end{verbatim}

The target value and each of the feature/value pairs are separated by a
space character. Feature/value pairs MUST be ordered by increasing
feature number. \textbf{(Please do this in \texttt{save\_svmlight()}.)}
Features with value zero can be skipped. For example, the feature vector
in SVMLight format will look like:

\begin{verbatim}
1 2:0.5 3:0.12 10:0.9 2000:0.3
0 4:1.0 78:0.6 1009:0.2
1 33:0.1 34:0.98 1000:0.8 3300:0.2
1 34:0.1 389:0.32
\end{verbatim}

where, 1 or 0 will indicate whether the patient has heart failure or not
(i.e.~the label) and it will be followed by a series of feature-value
pairs \textbf{sorted} by the feature index (idx) value.

You may find \emph{utils.py} useful. You can review the code by running
\texttt{\%load\ utils.py}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} \PYZpc{}load   ../HW1\PYZhy{}lib/utils.py}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{16}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{utils}
\PY{k+kn}{import} \PY{n+nn}{collections}

\PY{k}{def} \PY{n+nf}{create\PYZus{}features}\PY{p}{(}\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in}\PY{p}{)}\PY{p}{:}
    \PY{n}{indx\PYZus{}vid} \PY{o}{=} \PY{n}{calculate\PYZus{}index\PYZus{}vid}\PY{p}{(}\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Filter events in observation window}
    \PY{n}{filtered\PYZus{}events} \PY{o}{=} \PY{n}{filter\PYZus{}events}\PY{p}{(}\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{indx\PYZus{}vid}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Aggregate to features}
    \PY{n}{aggregated\PYZus{}events} \PY{o}{=} \PY{n}{aggregate\PYZus{}events}\PY{p}{(}\PY{n}{filtered\PYZus{}events}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} 1) patient\PYZus{}features: pid \PYZhy{}\PYZgt{} sorted list of (feature\PYZus{}id, feature\PYZus{}value)}
    \PY{n}{patient\PYZus{}features} \PY{o}{=} \PY{p}{(}
        \PY{n}{aggregated\PYZus{}events}
        \PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
        \PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{df}\PY{p}{:} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                                   \PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{feature\PYZus{}value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{float}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{o}{.}\PY{n}{to\PYZus{}dict}\PY{p}{(}\PY{p}{)}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} 2) hf: pid \PYZhy{}\PYZgt{} 1 for HF patients ONLY (as requested)}
    \PY{n}{hf} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n+nb}{int}\PY{p}{(}\PY{n}{pid}\PY{p}{)}\PY{p}{:} \PY{l+m+mi}{1} \PY{k}{for} \PY{n}{pid} \PY{o+ow}{in} \PY{n}{hf\PYZus{}in}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{\PYZcb{}}

    \PY{c+c1}{\PYZsh{} Ensure integer keys}
    \PY{n}{patient\PYZus{}features} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n+nb}{int}\PY{p}{(}\PY{n}{pid}\PY{p}{)}\PY{p}{:} \PY{n}{feats} \PY{k}{for} \PY{n}{pid}\PY{p}{,} \PY{n}{feats} \PY{o+ow}{in} \PY{n}{patient\PYZus{}features}\PY{o}{.}\PY{n}{items}\PY{p}{(}\PY{p}{)}\PY{p}{\PYZcb{}}

    \PY{k}{return} \PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf}


\PY{k}{def} \PY{n+nf}{save\PYZus{}svmlight}\PY{p}{(}\PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{n}{op\PYZus{}file}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
\PY{l+s+sd}{    Writes features in SVMlight format:}

\PY{l+s+sd}{        \PYZlt{}label\PYZgt{} \PYZlt{}fid\PYZgt{}:\PYZlt{}fval\PYZgt{} \PYZlt{}fid\PYZgt{}:\PYZlt{}fval\PYZgt{} ...}

\PY{l+s+sd}{    Requirements enforced here:}
\PY{l+s+sd}{      \PYZhy{} label: +1 if pid in hf else \PYZhy{}1}
\PY{l+s+sd}{      \PYZhy{} feature ids: positive ints, strictly increasing per line}
\PY{l+s+sd}{      \PYZhy{} duplicates collapsed (summed), zeros/NaNs removed}
\PY{l+s+sd}{      \PYZhy{} stable pid ascending order; features sorted by fid}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{k+kn}{import} \PY{n+nn}{math}
    \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{op\PYZus{}file}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{wb}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} \PY{k}{as} \PY{n}{f}\PY{p}{:}
        \PY{k}{for} \PY{n}{pid} \PY{o+ow}{in} \PY{n+nb}{sorted}\PY{p}{(}\PY{n}{patient\PYZus{}features}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n}{feats} \PY{o}{=} \PY{n}{patient\PYZus{}features}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{n}{pid}\PY{p}{,} \PY{p}{[}\PY{p}{]}\PY{p}{)}

            \PY{c+c1}{\PYZsh{} Collapse any duplicate feature\PYZus{}ids just in case}
            \PY{n}{merged} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
            \PY{k}{for} \PY{n}{fid}\PY{p}{,} \PY{n}{val} \PY{o+ow}{in} \PY{n}{feats}\PY{p}{:}
                \PY{k}{if} \PY{n}{fid} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                    \PY{k}{continue}
                \PY{c+c1}{\PYZsh{} ensure 1\PYZhy{}based, positive int}
                \PY{n}{fid\PYZus{}int} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{fid}\PY{p}{)}
                \PY{k}{if} \PY{n}{fid\PYZus{}int} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
                    \PY{n}{fid\PYZus{}int} \PY{o}{=} \PY{n}{fid\PYZus{}int} \PY{o}{+} \PY{l+m+mi}{1}  \PY{c+c1}{\PYZsh{} minimal nudge if upstream were 0\PYZhy{}based}
                    \PY{k}{if} \PY{n}{fid\PYZus{}int} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
                        \PY{k}{continue}
                \PY{c+c1}{\PYZsh{} accumulate}
                \PY{n}{merged}\PY{p}{[}\PY{n}{fid\PYZus{}int}\PY{p}{]} \PY{o}{=} \PY{n}{merged}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{n}{fid\PYZus{}int}\PY{p}{,} \PY{l+m+mf}{0.0}\PY{p}{)} \PY{o}{+} \PY{n+nb}{float}\PY{p}{(}\PY{n}{val}\PY{p}{)}

            \PY{c+c1}{\PYZsh{} drop zeros/NaNs}
            \PY{n}{items} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{fid}\PY{p}{,} \PY{n}{v}\PY{p}{)} \PY{k}{for} \PY{n}{fid}\PY{p}{,} \PY{n}{v} \PY{o+ow}{in} \PY{n}{merged}\PY{o}{.}\PY{n}{items}\PY{p}{(}\PY{p}{)} \PY{k}{if} \PY{p}{(}\PY{o+ow}{not} \PY{n}{math}\PY{o}{.}\PY{n}{isnan}\PY{p}{(}\PY{n}{v}\PY{p}{)}\PY{p}{)} \PY{o+ow}{and} \PY{n}{v} \PY{o}{!=} \PY{l+m+mf}{0.0}\PY{p}{]}
            \PY{n}{items}\PY{o}{.}\PY{n}{sort}\PY{p}{(}\PY{n}{key}\PY{o}{=}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}  \PY{c+c1}{\PYZsh{} strictly increasing}

            \PY{n}{label} \PY{o}{=} \PY{o}{+}\PY{l+m+mi}{1} \PY{k}{if} \PY{n+nb}{int}\PY{p}{(}\PY{n}{pid}\PY{p}{)} \PY{o+ow}{in} \PY{n}{hf} \PY{k}{else} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}

            \PY{k}{if} \PY{n}{items}\PY{p}{:}
                \PY{n}{parts} \PY{o}{=} \PY{p}{[}\PY{n+nb}{str}\PY{p}{(}\PY{n}{label}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}}\PY{n}{fid}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{:}\PY{l+s+si}{\PYZob{}}\PY{n}{v}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}} \PY{k}{for} \PY{n}{fid}\PY{p}{,} \PY{n}{v} \PY{o+ow}{in} \PY{n}{items}\PY{p}{]}
            \PY{k}{else}\PY{p}{:}
                \PY{c+c1}{\PYZsh{} patients with no features still get a label\PYZhy{}only line}
                \PY{n}{parts} \PY{o}{=} \PY{p}{[}\PY{n+nb}{str}\PY{p}{(}\PY{n}{label}\PY{p}{)}\PY{p}{]}

            \PY{n}{line} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{parts}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
            \PY{n}{f}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{n}{line}\PY{o}{.}\PY{n}{encode}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{utf\PYZhy{}8}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{17}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
\PY{n}{events\PYZus{}in} \PY{o}{=} \PY{n}{events\PYZus{}in}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{1000}\PY{p}{]}
\PY{n}{hf\PYZus{}in} \PY{o}{=} \PY{n}{hf\PYZus{}in}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{100}\PY{p}{]}
\PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf} \PY{o}{=} \PY{n}{create\PYZus{}features}\PY{p}{(}\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in}\PY{p}{)}
\PY{k}{assert} \PY{l+m+mi}{78} \PY{o+ow}{in} \PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{create\PYZus{}features is missing patients}\PY{l+s+s2}{\PYZdq{}}
\PY{k}{assert} \PY{n+nb}{len}\PY{p}{(}\PY{n}{patient\PYZus{}features}\PY{p}{[}\PY{l+m+mi}{78}\PY{p}{]}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{127}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{create\PYZus{}features is wrong}\PY{l+s+s2}{\PYZdq{}}
\PY{k}{assert} \PY{n}{patient\PYZus{}features}\PY{p}{[}\PY{l+m+mi}{78}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]} \PY{o}{==} \PY{p}{[}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{164}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{175}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{182}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{190}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{create\PYZus{}features is wrong}\PY{l+s+s2}{\PYZdq{}}
\PY{k}{assert} \PY{n+nb}{len}\PY{p}{(}\PY{n}{hf}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{101}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{create\PYZus{}features is wrong}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    The whole pipeline:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{TRAIN\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
    \PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf} \PY{o}{=} \PY{n}{create\PYZus{}features}\PY{p}{(}\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in}\PY{p}{)}
    \PY{n}{save\PYZus{}svmlight}\PY{p}{(}\PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{features\PYZus{}svmlight.train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
    \PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in} \PY{o}{=} \PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{VAL\PYZus{}DATA\PYZus{}PATH}\PY{p}{)}
    \PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf} \PY{o}{=} \PY{n}{create\PYZus{}features}\PY{p}{(}\PY{n}{events\PYZus{}in}\PY{p}{,} \PY{n}{hf\PYZus{}in}\PY{p}{,} \PY{n}{feature\PYZus{}map\PYZus{}in}\PY{p}{)}
    \PY{n}{save\PYZus{}svmlight}\PY{p}{(}\PY{n}{patient\PYZus{}features}\PY{p}{,} \PY{n}{hf}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{features\PYZus{}svmlight.val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
\PY{n}{main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{predictive-modeling-40-points}{%
\subsection{3 Predictive Modeling {[}40
points{]}}\label{predictive-modeling-40-points}}

Make sure you have finished section 2 before you start to work on this
question because some of the files generated in section 2
(\emph{features\_svmlight.train}) will be used in this question.

    \hypertarget{model-creation-20-points}{%
\subsubsection{3.1 Model Creation {[}20
points{]}}\label{model-creation-20-points}}

In the previous question, you constructed feature vectors for patients
to be used as training data in various predictive models (classifiers).
Now you will use this training data (\emph{features\_svmlight.train}) in
3 predictive models.

    \textbf{Step - a. Implement Logistic Regression, SVM and Decision Tree.
Skeleton code is provided in the following code cell.}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets} \PY{k+kn}{import} \PY{n}{load\PYZus{}svmlight\PYZus{}file}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{svm} \PY{k+kn}{import} \PY{n}{LinearSVC}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{tree} \PY{k+kn}{import} \PY{n}{DecisionTreeClassifier}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{o}{*}

\PY{k+kn}{import} \PY{n+nn}{utils}


\PY{c+c1}{\PYZsh{} PLEASE USE THE GIVEN FUNCTION NAME, DO NOT CHANGE IT.}
\PY{c+c1}{\PYZsh{} USE THIS RANDOM STATE FOR ALL OF THE PREDICTIVE MODELS.}
\PY{c+c1}{\PYZsh{} OR THE TESTS WILL NEVER PASS.}
\PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{545510477}


\PY{c+c1}{\PYZsh{}input: X\PYZus{}train, Y\PYZus{}train}
\PY{c+c1}{\PYZsh{}output: Y\PYZus{}pred}
\PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{545510477}

\PY{k}{def} \PY{n+nf}{logistic\PYZus{}regression\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{:}
    \PY{n}{clf} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{,} \PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{1000}\PY{p}{)}
    \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{k}{return} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{svm\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{:}
    \PY{n}{clf} \PY{o}{=} \PY{n}{LinearSVC}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
    \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{k}{return} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{decisionTree\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{:}
    \PY{n}{clf} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{n}{max\PYZus{}depth}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
    \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{k}{return} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{classification\PYZus{}metrics}\PY{p}{(}\PY{n}{Y\PYZus{}pred}\PY{p}{,} \PY{n}{Y\PYZus{}true}\PY{p}{)}\PY{p}{:}
    \PY{n}{acc} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{n}{recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{n}{f1score} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{k}{return} \PY{n}{acc}\PY{p}{,} \PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{f1score}


    
\PY{c+c1}{\PYZsh{}input: Name of classifier, predicted labels, actual labels}
\PY{k}{def} \PY{n+nf}{display\PYZus{}metrics}\PY{p}{(}\PY{n}{classifierName}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{,} \PY{n}{Y\PYZus{}true}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Classifier: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{classifierName}\PY{p}{)}\PY{p}{)}
    \PY{n}{acc}\PY{p}{,} \PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{f1score} \PY{o}{=} \PY{n}{classification\PYZus{}metrics}\PY{p}{(}\PY{n}{Y\PYZus{}pred}\PY{p}{,}\PY{n}{Y\PYZus{}true}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{acc}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{precision}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{recall}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}score: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{f1score}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    
\PY{k}{def} \PY{n+nf}{main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train} \PY{o}{=} \PY{n}{utils}\PY{o}{.}\PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.train}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{n}{display\PYZus{}metrics}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{logistic\PYZus{}regression\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{n}{display\PYZus{}metrics}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{svm\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{,}\PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{n}{display\PYZus{}metrics}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{decisionTree\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}

    
\PY{n}{main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{20}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{k+kn}{from} \PY{n+nn}{utils} \PY{k+kn}{import} \PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}
\PY{k+kn}{from} \PY{n+nn}{numpy}\PY{n+nn}{.}\PY{n+nn}{testing} \PY{k+kn}{import} \PY{n}{assert\PYZus{}almost\PYZus{}equal}

\PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} 3.1a Training Accuracy [3 points]}
\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train} \PY{o}{=} \PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.train}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} test\PYZus{}accuracy\PYZus{}lr}
\PY{n}{expected} \PY{o}{=} \PY{l+m+mf}{0.856338028169014}
\PY{n}{Y\PYZus{}pred} \PY{o}{=} \PY{n}{logistic\PYZus{}regression\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
\PY{n}{actual} \PY{o}{=} \PY{n}{classification\PYZus{}metrics}\PY{p}{(}\PY{n}{Y\PYZus{}pred}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{assert\PYZus{}almost\PYZus{}equal}\PY{p}{(}\PY{n}{actual}\PY{p}{,} \PY{n}{expected}\PY{p}{,} \PY{n}{decimal}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{err\PYZus{}msg}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{test\PYZus{}accuracy\PYZus{}lr failed!}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \textbf{Step - b. Evaluate your predictive models on a separate test
dataset in \emph{features\_svmlight.val} (binary labels are provided in
that svmlight file as the first field). Skeleton code is provided in the
following code cell.}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets} \PY{k+kn}{import} \PY{n}{load\PYZus{}svmlight\PYZus{}file}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{svm} \PY{k+kn}{import} \PY{n}{LinearSVC}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{tree} \PY{k+kn}{import} \PY{n}{DecisionTreeClassifier}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{o}{*}

\PY{k+kn}{import} \PY{n+nn}{utils}


\PY{c+c1}{\PYZsh{} PLEASE USE THE GIVEN FUNCTION NAME, DO NOT CHANGE IT.}
\PY{c+c1}{\PYZsh{} USE THIS RANDOM STATE FOR ALL OF THE PREDICTIVE MODELS.}
\PY{c+c1}{\PYZsh{} OR THE TESTS WILL NEVER PASS.}
\PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{545510477}


\PY{c+c1}{\PYZsh{}input: X\PYZus{}train, Y\PYZus{}train and X\PYZus{}test}
\PY{c+c1}{\PYZsh{}output: Y\PYZus{}pred}
\PY{k}{def} \PY{n+nf}{logistic\PYZus{}regression\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{:}
    \PY{n}{clf} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{,} \PY{n}{max\PYZus{}iter}\PY{o}{=}\PY{l+m+mi}{1000}\PY{p}{)}
    \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{k}{return} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{svm\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{:}
    \PY{n}{clf} \PY{o}{=} \PY{n}{LinearSVC}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
    \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{k}{return} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{decisionTree\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{:}
    \PY{n}{clf} \PY{o}{=} \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{n}{max\PYZus{}depth}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
    \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{)}
    \PY{k}{return} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{classification\PYZus{}metrics}\PY{p}{(}\PY{n}{Y\PYZus{}pred}\PY{p}{,} \PY{n}{Y\PYZus{}true}\PY{p}{)}\PY{p}{:}
    \PY{n}{acc} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{n}{precision} \PY{o}{=} \PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{n}{recall} \PY{o}{=} \PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{n}{f1score} \PY{o}{=} \PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{Y\PYZus{}true}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{)}
    \PY{k}{return} \PY{n}{acc}\PY{p}{,} \PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{f1score}

    
\PY{c+c1}{\PYZsh{}input: Name of classifier, predicted labels, actual labels}
\PY{k}{def} \PY{n+nf}{display\PYZus{}metrics}\PY{p}{(}\PY{n}{classifierName}\PY{p}{,} \PY{n}{Y\PYZus{}pred}\PY{p}{,} \PY{n}{Y\PYZus{}true}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Classifier: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{classifierName}\PY{p}{)}\PY{p}{)}
    \PY{n}{acc}\PY{p}{,} \PY{n}{precision}\PY{p}{,} \PY{n}{recall}\PY{p}{,} \PY{n}{f1score} \PY{o}{=} \PY{n}{classification\PYZus{}metrics}\PY{p}{(}\PY{n}{Y\PYZus{}pred}\PY{p}{,}\PY{n}{Y\PYZus{}true}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{acc}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Precision: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{precision}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recall: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{recall}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{F1\PYZhy{}score: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{f1score}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}\PYZus{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    
\PY{k}{def} \PY{n+nf}{main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train} \PY{o}{=} \PY{n}{utils}\PY{o}{.}\PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.train}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{Y\PYZus{}test} \PY{o}{=} \PY{n}{utils}\PY{o}{.}\PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.val}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}

    \PY{n}{display\PYZus{}metrics}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Logistic Regression}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{logistic\PYZus{}regression\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{,} \PY{n}{Y\PYZus{}test}\PY{p}{)}
    \PY{n}{display\PYZus{}metrics}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{svm\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{,} \PY{n}{Y\PYZus{}test}\PY{p}{)}
    \PY{n}{display\PYZus{}metrics}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{decisionTree\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{,} \PY{n}{Y\PYZus{}test}\PY{p}{)}


\PY{n}{main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{22}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{k+kn}{from} \PY{n+nn}{utils} \PY{k+kn}{import} \PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}
\PY{k+kn}{from} \PY{n+nn}{numpy}\PY{n+nn}{.}\PY{n+nn}{testing} \PY{k+kn}{import} \PY{n}{assert\PYZus{}almost\PYZus{}equal}

\PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} 3.1b Prediction Accuracy [3 points]}
\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train} \PY{o}{=} \PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.train}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{Y\PYZus{}test} \PY{o}{=} \PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.val}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} test\PYZus{}accuracy\PYZus{}lr}
\PY{n}{expected} \PY{o}{=} \PY{l+m+mf}{0.6937086092715232}
\PY{n}{Y\PYZus{}pred} \PY{o}{=} \PY{n}{logistic\PYZus{}regression\PYZus{}pred}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{Y\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{)}
\PY{n}{actual} \PY{o}{=} \PY{n}{classification\PYZus{}metrics}\PY{p}{(}\PY{n}{Y\PYZus{}pred}\PY{p}{,} \PY{n}{Y\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{assert\PYZus{}almost\PYZus{}equal}\PY{p}{(}\PY{n}{actual}\PY{p}{,} \PY{n}{expected}\PY{p}{,} \PY{n}{decimal}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{err\PYZus{}msg}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{test\PYZus{}accuracy\PYZus{}lr failed!}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{model-validation-20-points}{%
\subsubsection{3.2 Model Validation {[}20
points{]}}\label{model-validation-20-points}}

In order to fully utilize the available data and obtain more reliable
results, machine learning practitioners use cross-validation to evaluate
and improve their predictive models. You will demonstrate using two
cross-validation strategies against SVM.

\begin{itemize}
\tightlist
\item
  K-fold: Divide all the data into \(k\) groups of samples. Each time
  \(\frac{1}{k}\) samples will be used as test data and the remaining
  samples as training data.
\item
  Randomized K-fold: Iteratively random shuffle the whole dataset and
  use top specific percentage of data as training and the rest as test.
\end{itemize}

    \textbf{Implement the two cross-validation strategies.} -
\textbf{K-fold:} Use the number of iterations k=5; - \textbf{Randomized
K-fold}: Use a test data percentage of 20\% and k=5 for the number of
iterations for Randomized

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{23}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{KFold}\PY{p}{,} \PY{n}{ShuffleSplit}
\PY{k+kn}{from} \PY{n+nn}{numpy} \PY{k+kn}{import} \PY{n}{mean}

\PY{k+kn}{import} \PY{n+nn}{utils}


\PY{c+c1}{\PYZsh{} PLEASE USE THE GIVEN FUNCTION NAME, DO NOT CHANGE IT.}
\PY{c+c1}{\PYZsh{} USE THIS RANDOM STATE FOR ALL OF THE PREDICTIVE MODELS.}
\PY{c+c1}{\PYZsh{} OR THE TESTS WILL NEVER PASS.}
\PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{545510477}


\PY{c+c1}{\PYZsh{}input: training data and corresponding labels}
\PY{c+c1}{\PYZsh{}output: f1}
\PY{k}{def} \PY{n+nf}{get\PYZus{}f1\PYZus{}kfold}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{,} \PY{n}{k}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{:}
    \PY{n}{kf} \PY{o}{=} \PY{n}{KFold}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{n}{k}\PY{p}{,} \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
    \PY{n}{scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{for} \PY{n}{tr\PYZus{}idx}\PY{p}{,} \PY{n}{te\PYZus{}idx} \PY{o+ow}{in} \PY{n}{kf}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{:}
        \PY{n}{clf} \PY{o}{=} \PY{n}{LinearSVC}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
        \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{[}\PY{n}{tr\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{Y}\PY{p}{[}\PY{n}{tr\PYZus{}idx}\PY{p}{]}\PY{p}{)}
        \PY{n}{yhat} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X}\PY{p}{[}\PY{n}{te\PYZus{}idx}\PY{p}{]}\PY{p}{)}
        \PY{n}{scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{Y}\PY{p}{[}\PY{n}{te\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{yhat}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n+nb}{float}\PY{p}{(}\PY{n}{mean}\PY{p}{(}\PY{n}{scores}\PY{p}{)}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{get\PYZus{}f1\PYZus{}randomisedCV}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{,} \PY{n}{iterNo}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{test\PYZus{}percent}\PY{o}{=}\PY{l+m+mf}{0.20}\PY{p}{)}\PY{p}{:}
    \PY{n}{ss} \PY{o}{=} \PY{n}{ShuffleSplit}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{n}{iterNo}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{n}{test\PYZus{}percent}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
    \PY{n}{scores} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{for} \PY{n}{tr\PYZus{}idx}\PY{p}{,} \PY{n}{te\PYZus{}idx} \PY{o+ow}{in} \PY{n}{ss}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{:}
        \PY{n}{clf} \PY{o}{=} \PY{n}{LinearSVC}\PY{p}{(}\PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
        \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{[}\PY{n}{tr\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{Y}\PY{p}{[}\PY{n}{tr\PYZus{}idx}\PY{p}{]}\PY{p}{)}
        \PY{n}{yhat} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X}\PY{p}{[}\PY{n}{te\PYZus{}idx}\PY{p}{]}\PY{p}{)}
        \PY{n}{scores}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{f1\PYZus{}score}\PY{p}{(}\PY{n}{Y}\PY{p}{[}\PY{n}{te\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{yhat}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n+nb}{float}\PY{p}{(}\PY{n}{mean}\PY{p}{(}\PY{n}{scores}\PY{p}{)}\PY{p}{)}

    
\PY{k}{def} \PY{n+nf}{main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{X}\PY{p}{,}\PY{n}{Y} \PY{o}{=} \PY{n}{utils}\PY{o}{.}\PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.train}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Classifier: SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{f1\PYZus{}k} \PY{o}{=} \PY{n}{get\PYZus{}f1\PYZus{}kfold}\PY{p}{(}\PY{n}{X}\PY{p}{,}\PY{n}{Y}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average F1 Score in KFold CV: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{f1\PYZus{}k}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n}{f1\PYZus{}r} \PY{o}{=} \PY{n}{get\PYZus{}f1\PYZus{}randomisedCV}\PY{p}{(}\PY{n}{X}\PY{p}{,}\PY{n}{Y}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average F1 Score in Randomised CV: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{f1\PYZus{}r}\PY{p}{)}\PY{p}{)}\PY{p}{)}


\PY{n}{main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{24}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\PY{l+s+sd}{AUTOGRADER CELL. DO NOT MODIFY THIS.}
\PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}

\PY{k+kn}{from} \PY{n+nn}{numpy}\PY{n+nn}{.}\PY{n+nn}{testing} \PY{k+kn}{import} \PY{n}{assert\PYZus{}almost\PYZus{}equal}

\PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} 3.2 Cross Validation F1 [10 points]}
\PY{c+c1}{\PYZsh{} test\PYZus{}f1\PYZus{}cv\PYZus{}kfold}
\PY{n}{expected} \PY{o}{=} \PY{l+m+mf}{0.7258461959533061}
\PY{n}{X}\PY{p}{,} \PY{n}{Y} \PY{o}{=} \PY{n}{get\PYZus{}data\PYZus{}from\PYZus{}svmlight}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{features\PYZus{}svmlight.train}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{actual} \PY{o}{=} \PY{n}{get\PYZus{}f1\PYZus{}kfold}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{)}
\PY{n}{assert\PYZus{}almost\PYZus{}equal}\PY{p}{(}\PY{n}{actual}\PY{p}{,} \PY{n}{expected}\PY{p}{,} \PY{n}{decimal}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{err\PYZus{}msg}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{test\PYZus{}f1\PYZus{}cv\PYZus{}kfold failed!}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
